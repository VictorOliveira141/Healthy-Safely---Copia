<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tarefas</title>
    <link rel="stylesheet" href="../css/tarefas.css" />
    <link rel="icon" href="../imagem/Logo repaginado 2.png" />
    <link rel="icon" href="../imagem/Logo repaginado 2.png" />
  </head>
  <body>
    <%- include('../partials/header.ejs') %>
    <!---->
    <%- include('../partials/menu-inferior.ejs') %>

    <section class="bannerdetarefa">
      <img
        src="../imagem/tarefa.png"
        alt="tarefasbanner"
        class="confiratarefas"
      />
    </section>

     <section class="placar">
    <h2>SEUS PONTOS DESSE M√äS</h2>

    <article class="tabela">
      <table>
        <thead>
          <tr>
            <th>T√ìPICOS</th>
            <th>PONTOS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>üåÄ TAREFAS DI√ÅRIAS</td>
            <td><%= tarefas.filter(t => t.concluida).reduce((sum, t) => sum + t.pontos, 0) %> PTS</td>
          </tr>
        </tbody>
      </table>
    </article>

    <article class="rodape-pontos">
      <img src="../imagem/a.png" alt="Moedinha" class="moeda">
      <span><strong>HEALTHY POINTS totais:</strong></span>
      <span class="numero-total"><%= tarefas.filter(t => t.concluida).reduce((sum, t) => sum + t.pontos, 0) %></span>
    </article>
  </section>
  
    <main class="tarefassas">
      <section class="suastarefas">
        <h1 class="st">SUAS TAREFAS</h1>
      </section>
      
      <section class="lista-tarefas">
        <% tarefas.forEach((tarefa, index) => { %>
          <article class="tarefa-item <%= tarefa.concluida ? 'concluida' : '' %>" data-id="<%= tarefa.id %>">
            <input type="checkbox" <%= tarefa.concluida ? 'checked' : '' %> onchange="toggleTask(this, <%= index %>)" />
            <span><%= tarefa.nome %></span>
            <span class="pontos">+<%= tarefa.pontos %> pts</span>
          </article>
        <% }); %>
      </section>
    </main>
    <section class="footer"><%- include('../partials/footer.ejs') %></section>

    <script>
      function toggleTask(checkbox, index) {
        const item = checkbox.closest('.tarefa-item');
        const pontosSpan = item.querySelector('.pontos');
        const pontos = parseInt(pontosSpan.textContent.replace(/\D/g, ''));
        
        // Update local storage
        let tarefas = JSON.parse(localStorage.getItem('tarefas')) || <%= JSON.stringify(tarefas) %>;
        tarefas[index].concluida = checkbox.checked;
        localStorage.setItem('tarefas', JSON.stringify(tarefas));
        
        // Update UI
        if (checkbox.checked) {
          item.classList.add('concluida');
        } else {
          item.classList.remove('concluida');
        }
        
        // Update points display
        updatePoints();
      }
      
      function updatePoints() {
        let tarefas = JSON.parse(localStorage.getItem('tarefas')) || <%= JSON.stringify(tarefas) %>;
        const totalPoints = tarefas.filter(t => t.concluida).reduce((sum, t) => sum + t.pontos, 0);
        document.querySelector('.numero-total').textContent = totalPoints;
        
        // Update table
        const tableRows = document.querySelectorAll('.tabela tbody tr');
        tableRows.forEach(row => {
          if (row.cells[0].textContent.includes('TAREFAS DI√ÅRIAS')) {
            row.cells[1].textContent = totalPoints + ' PTS';
          }
        });
      }
      
      // Load from localStorage on page load
      document.addEventListener('DOMContentLoaded', function() {
        let tarefas = JSON.parse(localStorage.getItem('tarefas')) || <%= JSON.stringify(tarefas) %>;
        tarefas.forEach((tarefa, index) => {
          const item = document.querySelector(`.tarefa-item[data-id="${tarefa.id}"]`);
          const checkbox = item.querySelector('input[type="checkbox"]');
          checkbox.checked = tarefa.concluida;
          if (tarefa.concluida) {
            item.classList.add('concluida');
          }
        });
        updatePoints();
      });
    </script>
  </body>
</html>
