<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ProgressÃ£o</title>
    <link rel="stylesheet" href="../css/progressao.css" />
    <link rel="icon" href="../imagem/Logo repaginado 2.png" />
  </head>
  <body>
    <%- include('../partials/header.ejs') %>
    <!---->
    <%- include('../partials/menu-inferior.ejs') %>

    <main class="container">
      <!--TOPO-->
      <section class="topo">
        <h1>ProgressÃ£o</h1>
        <p>Veja seu progresso e conquistas!</p>
      </section>

      <!-- EstatÃ­sticas -->
      <section class="stats">
        <article class="stat">
          <h3>Pontos Totais</h3>
          <p><%= pontosTotais %></p>
        </article>
        <article class="stat">
          <h3>Tarefas ConcluÃ­das</h3>
          <p><%= tarefasConcluidas %></p>
        </article>
        <article class="stat">
          <h3>Medalha Atual</h3>
          <p><%= medalha %></p>
        </article>
      </section>

      <!-- Barra de Progresso -->
      <section class="progress-section">
        <h2>Progresso Geral</h2>
        <section class="progress-bar">
          <section class="progress-fill" style="width: <%= progresso %>%"></section>
        </section>
        <p><%= progresso %>% concluÃ­do</p>
      </section>

      <!-- Medalhas -->
      <section class="medals">
        <h2>Medalhas Conquistadas</h2>
        <section class="medal-list">
          <% if (pontosTotais >= 100) { %>
            <article class="medal">ðŸ¥‰ Iniciante</article>
          <% } %>
          <% if (pontosTotais >= 300) { %>
            <article class="medal">ðŸ¥ˆ Consistente</article>
          <% } %>
          <% if (pontosTotais >= 700) { %>
            <article class="medal">ðŸ¥‡ AvanÃ§ado</article>
          <% } %>
        </section>
      </section>
    </main>

    <script src="../js/grafico.js"></script>
    <script>
      // Animate progress bar on load
      document.addEventListener('DOMContentLoaded', function() {
        updateProgressFromStorage();
      });
      
      function updateProgressFromStorage() {
        let tarefas = JSON.parse(localStorage.getItem('tarefas')) || <%= JSON.stringify(tarefas) %>;
        const pontosTotais = tarefas.filter(t => t.concluida).reduce((sum, t) => sum + t.pontos, 0);
        const tarefasConcluidas = tarefas.filter(t => t.concluida).length;
        const progresso = (tarefasConcluidas / tarefas.length) * 100;
        
        // Update stats
        document.querySelector('.stat p').textContent = pontosTotais; // Assuming first stat is pontos
        document.querySelectorAll('.stat p')[1].textContent = tarefasConcluidas; // Second stat
        
        // Update progress bar
        const progressFill = document.querySelector('.progress-fill');
        progressFill.style.width = '0%';
        setTimeout(() => {
          progressFill.style.width = progresso + '%';
        }, 500);
        document.querySelector('.progress-section p').textContent = Math.round(progresso) + '% concluÃ­do';
        
        // Update medal
        let medalha = "";
        if (pontosTotais >= 700) medalha = "ðŸ¥‡ AvanÃ§ado";
        else if (pontosTotais >= 300) medalha = "ðŸ¥ˆ Consistente";
        else if (pontosTotais >= 100) medalha = "ðŸ¥‰ Iniciante";
        document.querySelectorAll('.stat p')[2].textContent = medalha;
        
        // Update medals list
        const medalList = document.querySelector('.medal-list');
        medalList.innerHTML = '';
        if (pontosTotais >= 100) {
          medalList.innerHTML += '<article class="medal">ðŸ¥‰ Iniciante</article>';
        }
        if (pontosTotais >= 300) {
          medalList.innerHTML += '<article class="medal">ðŸ¥ˆ Consistente</article>';
        }
        if (pontosTotais >= 700) {
          medalList.innerHTML += '<article class="medal">ðŸ¥‡ AvanÃ§ado</article>';
        }
      }
    </script>

    <%- include('../partials/footer.ejs') %>
  </body>
</html>
