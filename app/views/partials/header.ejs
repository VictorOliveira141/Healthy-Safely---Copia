<link rel="stylesheet" href="/css/header.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- HEADER TOP -->
<article class="header">
  <nav
    class="header-nav2 <%= (usuario && usuario.tipo === 'farmacia') ? 'farmacia' : 'cliente' %>"
    id="mobileNav"
    aria-label="Navega√ß√£o principal"
  >
    <article class="nav-spacer">
      <% if (usuario && usuario.tipo === "farmacia") { %>
      <a href="/adm/home2">Minha loja</a>
      <a href="/adm/adicionarproduto">Adicionar Produto</a>
      <a href="/adm/gerenciarpedidos">Pedidos</a>
      <a href="/adm/vendas">Vendas</a>
      <a href="/adm/avaliacoes">Avalia√ß√µes</a>
      <% } else { %>

      <a href="/loja">Loja</a>
      <a href="/#">Categorias</a>
      <a href="/meuscupons">Cupons</a>
      <a href="/meuspedidos">Meus Pedidos</a>
      <% } %>
    </article>

    <article class="nav-spacer">
      <a
        href="javascript:void(0);"
        class="notification-toggle"
        id="notificationMenuToggleDesktop"
        aria-controls="notificationMenu"
        aria-expanded="false"
        >Notifica√ß√µes</a
      >
      <a href="/#">Contato</a>
      <a href="/informacoes"> <i class="bi bi-info-circle"></i>Ajuda</a>
      <a href="/cadastroColaborador">Vender no Healthy Safely</a>
    </article>
  </nav>
</article>

<!-- HEADER BOTTOM -->
<article class="header">
  <section class="header-container">
    <!-- MENU HAMBURGUER MOBILE -->
    <section class="menu-toggle-wrapper" aria-label="Menu Hamburguer">
      <input type="checkbox" id="menuToggle" />
      <label for="menuToggle" class="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </label>

      <nav id="menu" aria-label="Conte√∫do do menu Hamburguer">
        <h1>Menu</h1>
        <ul>
          <% if (usuario && usuario.tipo === "farmacia") { %>
          <li>
            <a href="/adm/home2"><i class="bi bi-house"></i> In√≠cio</a>
          </li>

          <li>
            <a href="/adm/adicionarproduto"
              ><i class="bi bi-plus-circle"></i> Novo Produto</a
            >
          </li>
          <li>
            <a href="/adm/gerenciarpedidos"
              ><i class="bi bi-truck"></i> <span>Pedidos</span></a
            >
          </li>
          <li>
            <a href="/adm/vendas"
              ><i class="bi bi-graph-up-arrow"></i> Vendas</a
            >
          </li>
          <li>
            <a href="/adm/avaliacoes"
              ><i class="bi bi-star-fill"></i> Avalia√ß√µes</a
            >
          </li>

          <% } else { %>
          <li>
            <a href="/"><i class="bi bi-house"></i> In√≠cio</a>
          </li>
          <li>
            <a href="/loja"><i class="bi bi-shop"></i> Loja</a>
          </li>

          <li>
            <a href="/esportes-performance">
              <i class="bi bi-lightning-charge"></i> Esportes & Performance
            </a>
          </li>

          <li>
            <a href="/beleza-cuidados">
              <i class="bi bi-stars"></i> Beleza & Cuidados Especiais
            </a>
          </li>

          <li>
            <a href="/suplementos-vitaminas">
              <i class="bi bi-capsule"></i> Suplementos & Vitaminas
            </a>
          </li>

          <li>
            <a href="/bebes-criancas">
              <i class="bi bi-emoji-smile"></i> Beb√™s & Crian√ßas
            </a>
          </li>

          <li>
            <a href="/saude-prevencao">
              <i class="bi bi-heart-pulse"></i> Sa√∫de & Preven√ß√£o
            </a>
          </li>

          <li>
            <a href="/higiene"><i class="bi bi-bandaid"></i> Higiene</a>
          </li>

          <li>
            <a href="/meuscupons"><i class="bi bi-ticket"></i> Cupons</a>
          </li>

          <li>
            <a href="/informacoes"><i class="bi bi-info-circle"></i> Ajuda</a>
          </li>

          <li>
            <a href="/contato"><i class="bi bi-envelope"></i> Contato</a>
          </li>
        </ul>
        <% } %>

        <label for="menuToggle" class="close-menu">&times;</label>
      </nav>
    </section>

    <!-- LOGO -->
    <a
      href="/tomarammeutela"
      class="header-logo <%= (usuario && usuario.tipo === 'farmacia') ? 'farmacia' : 'cliente' %>"
      aria-label="Logo"
    >
      <img src="/imagem/1x/logozeko.png" alt="Healthy Safely" />
    </a>

    <!-- BARRA DE PESQUISA-->
    <form class="search-bar" role="search" aria-label="Barra de Pesquisa">
      <label class="search-icon" for="headerSearch">
        <svg width="15" height="15" viewBox="0 0 36 36" fill="none">
          <circle cx="16" cy="16" r="12" stroke="#fff" stroke-width="3" />
          <line
            x1="26"
            y1="26"
            x2="32"
            y2="32"
            stroke="#fff"
            stroke-width="3"
            stroke-linecap="round"
          />
        </svg>
      </label>
      <input type="text" id="headerSearch" placeholder="Busque o que deseja" />
    </form>

    <!-- A√á√ïES DO USUARIO -->
    <nav class="header-actions" aria-label="A√ß√µes do usu√°rio">
      <% if (!usuario || usuario.tipo === "cliente") { %>
      <!-- CARRINHO DE COMPRAS FECHADO-->
      <div class="user-menu" aria-label="Carrinho de compras (Fechado)">
        <a
          href="javascript:void(0);"
          class="action-btn"
          aria-label="Carrinho de compras"
          onclick="openCartMenu()"
        >
          <i class="bi bi-cart"></i>
        </a>
      </div>

      <!-- CARRINHO DE COMPRAS ABERTO-->
      <div
        id="cartSidebar"
        class="cart-sidebar"
        aria-label="Carrinho de compras (aberto)"
      >
        <div class="cart-header">
          <h2>Carrinho de Compras</h2>
          <button class="close-btn" onclick="closeCartMenu()">&times;</button>
        </div>

        <div class="cart-sidebar-content">
          <ul id="cartItems"></ul>
          <div
            id="emptyCartMessage"
            class="empty-cart-message"
            style="
              display: none;
              text-align: center;
              padding: 20px;
              color: #999;
            "
          >
            Seu carrinho est√° vazio.
          </div>
        </div>

        <div class="cart-footer">
          <div class="total">
            <span>Total:</span>
            <span id="cartTotal">R$ 0,00</span>
          </div>
          <button>Finalizar Compra</button>
        </div>
      </div>

      <% } %>

      <!-- MENU DE NOTIFICA√á√ïES-->
      <div
        class="user-menu <%= (usuario && usuario.tipo === 'farmacia') ? 'farmacia' : 'cliente' %>"
        aria-label="Menu de notifica√ß√µes"
      >
        <i
          class="bi bi-bell notification-toggle notificacao"
          id="notificationMenuToggleAction"
          aria-controls="notificationMenu"
          aria-expanded="false"
        ></i>
        <section
          id="notificationMenu"
          class="notification-dropdown hidden"
          role="menu"
        >
          <h3>Notifica√ß√µes</h3>
          <ul id="notificationList">
            <% if (usuario) { %>
            <li>Nenhuma notifica√ß√£o nova.</li>
            <% } else { %>
            <li>Por favor, fa√ßa login para ver suas notifica√ß√µes.</li>
            <% } %>
          </ul>
        </section>
      </div>

      <!-- CADASTRAR/LOGAR -->
      <div
        class="user-menu <%= (usuario && usuario.tipo === 'farmacia') ? 'farmacia' : 'cliente' %>"
      >
        <% if (usuario) { %>
        <a href="/perfil">
          <i class="bi bi-person-circle logado"></i>
        </a>

        <% if (usuario.tipo === "farmacia") { %>
        <span class="header-welcome">
          Ol√°, <strong><%= usuario.nome.split(' ')[0] %></strong> üëã
        </span>
        <% } %> <% } else { %>
        <div class="logar-cadastrar">
          <a href="/login">
            <i class="bi bi-person-circle"></i>
          </a>
          <a href="/login">Entrar</a>
          <span> | </span>
          <a href="/cadastro">Cadastrar</a>
        </div>
        <% } %>
      </div>
    </nav>
  </section>
</article>

<!-- BARRA DE PESQUISA MOBILE -->
<article class="fundo">
  <section class="search-bar2" role="search">
    <label class="search-icon" for="mobileSearch">
      <svg width="24" height="24" viewBox="0 0 36 36" fill="none">
        <circle cx="16" cy="16" r="12" stroke="#fff" stroke-width="3" />
        <line
          x1="26"
          y1="26"
          x2="32"
          y2="32"
          stroke="#fff"
          stroke-width="3"
          stroke-linecap="round"
        />
      </svg>
    </label>
    <input type="text" id="mobileSearch" placeholder="Busque o que deseja" />
  </section>
</article>

<!-- MODAL DE CADASTRO (aparece apenas ao clicar em "cadastrar")-->
<section
  id="headerModalCadastro"
  class="modal hidden"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modalCadastroTitle"
>
  <section class="modal-content">
    <button id="headerCloseCadastroModal" class="close-btn" aria-label="Fechar">
      &times;
    </button>

    <h2 class="modalCadastroTitle">Acessar contaüîê</h2>

    <a href="/login" class="btn-cadastro">Entrar</a>

    <p class="ou">ou</p>

    <p class="titulo-cadastro">Cadastrar como:</p>

    <section class="opcoes-cadastro">
      <a href="/cadastroCliente" class="btn-cadastro">Cliente</a>
      <a href="/cadastroColaborador" class="btn-cadastro"> Colaborador </a>
    </section>
  </section>
</section>

<!--SCRIPT DO MODAL CADASTRAR-->
<script src="/js/modal-header.js"></script>
<!--SCRIPT CARRINHO -->
<script src="/js/cart-product.js"></script>
<!-- SCRIPT PARA O MODAL DE NOTIFICA√á√ïES -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const notificationToggles = document.querySelectorAll(
      ".notification-toggle"
    );
    const notificationMenu = document.getElementById("notificationMenu");

    if (!notificationMenu) return;

    function setExpanded(state) {
      notificationToggles.forEach(function (t) {
        try {
          t.setAttribute("aria-expanded", state);
        } catch (e) {}
      });
    }

    function toggleNotificationMenu(event) {
      event && event.preventDefault();
      const isHidden = notificationMenu.classList.contains("hidden");
      if (isHidden) {
        notificationMenu.classList.remove("hidden");
        setExpanded("true");
      } else {
        notificationMenu.classList.add("hidden");
        setExpanded("false");
      }
    }

    notificationToggles.forEach(function (toggle) {
      toggle.addEventListener("click", toggleNotificationMenu);
      // allow keyboard activation when focused
      toggle.addEventListener("keydown", function (e) {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleNotificationMenu(e);
        }
      });
    });

    // Fechar o menu se clicar fora dele
    document.addEventListener("click", function (event) {
      const target = event.target;
      const clickedInsideMenu = notificationMenu.contains(target);
      const clickedOnToggle = Array.from(notificationToggles).some(function (
        t
      ) {
        return t.contains(target);
      });
      if (!clickedInsideMenu && !clickedOnToggle) {
        notificationMenu.classList.add("hidden");
        setExpanded("false");
      }
    });

    // Fechar com Escape
    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") {
        if (!notificationMenu.classList.contains("hidden")) {
          notificationMenu.classList.add("hidden");
          setExpanded("false");
        }
      }
    });
  });
</script>
