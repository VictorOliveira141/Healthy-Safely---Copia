<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/orientacoes.css" />
    <link rel="icon" href="../imagem/Logo repaginado 2.png" />
    <title>Chat</title>
  </head>
  <body>
    <%- include('../partials/header.ejs') %>

    <main class="container">
      <!-- Coluna lateral -->
      <aside class="sidebar">
        <h1>Chat</h1>
        <br />
        <ul>
          <li class="active" data-target="especialista1">
            <article class="especialista">
              <img src="../imagem/psicologa.png" />
              <section class="info">
                <h1>DRA.ALICE (PSICOLOGA)</h1>
                <h2>07/10/2024</h2>
                <section class="footer-info">
                  <h1>Meus parab√©ns pela sua progress√£o, voc√™...</h1>
                </section>
              </section>
            </article>
          </li>

          <li data-target="especialista2">
            <article class="especialista">
              <img src="../imagem/ortopedista.png" />
              <section class="info">
                <h1>DR.ALISON (ORTOPEDISTA)</h1>
                <h2>30/09/2024</h2>
                <section class="footer-info">
                  <h1>Ol√°! bom, o seu progresso por enquanto est√°...</h1>
                </section>
              </section>
            </article>
          </li>
        </ul>
      </aside>

      <!-- Conte√∫dos ao clicar -->
      <section class="content">
        <!--ESPECIALISTA 1-->
        <section id="especialista1" class="content-box active">
          <article class="especialista">
            <!--Bot√£o de sair do chat quando tiver 500px-->
            <button class="sair-chat"><i class="bi bi-arrow-left"></i></button>
            <img src="../imagem/psicologa.png" />
            <section class="info">
              <h1>DRA.Alice (PSICOLOGA)</h1>
              <h1>üü¢On-line</h1>
            </section>
          </article>

          <section class="mensagens">
            <article class="especialista-mensagem">
              <img src="../imagem/psicologa.png" />
              <section class="info">
                <p>
                  Meus parab√©ns pela sua progress√£o! Voc√™ concluiu todas as
                  tarefas sobre sa√∫de mental e respondeu muito bem as nossas
                  consultas on-line. Espero contar com voc√™ no pr√≥ximo desafio!
                  <span class="hora">10:35</span>
                </p>
              </section>
            </article>

            <article class="usuario-mensagem">
              <section class="info">
                <p>Muito obrigado, Dra. Alice! Foi um prazer participar.</p>
                <span class="hora">10:37</span>
              </section>
            </article>
          </section>

          <!-- Digitar mensagem -->
          <section class="chat-input">
            <input type="text" placeholder="Digite uma mensagem..." />
            <button type="button">
              <i class="bi bi-send"></i>
            </button>
          </section>
        </section>

        <!--ESPECIALISTA 2-->
        <section id="especialista2" class="content-box">
          <article class="especialista">
            <!--Bot√£o de sair do chat quando tiver 500px-->
            <button class="sair-chat"><i class="bi bi-arrow-left"></i></button>
            <img src="../imagem/ortopedista.png" />
            <section class="info">
              <h1>DR.Alison (ORTOPEDISTA)</h1>
              <h1>‚ö´Off-line</h1>
            </section>
          </article>

          <section class="mensagens">
            <article class="especialista-mensagem">
              <img src="../imagem/ortopedista.png" />
              <section class="info">
                <p>
                  Ol√°! Bom, o seu progresso, por enquanto, est√° satisfat√≥rio,
                  mas ser√° necess√°rio algumas melhorias, como cumprir os
                  exerc√≠cios passados em nossa consulta presencial, pois eu n√£o
                  recebi a confirma√ß√£o de todos os exerc√≠cios feitos do
                  tornozelo direito. De 15 exerc√≠cios, recebi apenas 10. Boa
                  recupera√ß√£o!
                  <span class="hora">10:35</span>
                </p>
              </section>
            </article>

            <article class="usuario-mensagem">
              <section class="info">
                <p>
                  Obrigado, DR. Alison, acabei fazendo apenas 10 exercicios pois
                  tinha alguns compromissos. Na pr√≥xima irei completar todos!
                </p>
                <span class="hora">10:37</span>
              </section>
            </article>
          </section>

          <!-- Digitar mensagem -->
          <section class="chat-input">
            <input type="text" placeholder="Digite uma mensagem..." />
            <button type="button">
              <i class="bi bi-send"></i>
            </button>
          </section>
        </section>
      </section>
    </main>

    <script>
      // ==================== SELE√á√ÉO DE ELEMENTOS ====================
      const container = document.querySelector(".container");
      const menuItems = document.querySelectorAll(".sidebar li");
      const contentBoxes = document.querySelectorAll(".content-box");
      const sairBotoes = document.querySelectorAll(".sair-chat");
      const chatInputs = document.querySelectorAll(".chat-input");

      // ==================== FUN√á√ÉO PARA CHECAR CHAT ATIVO ====================
      function checkActiveChat() {
        const anyActive = document.querySelector(".content-box.active");
        if (!anyActive) {
          container.classList.add("no-chat");
        } else {
          container.classList.remove("no-chat");
        }
      }

      // ==================== DESATIVA TODOS OS CHATS EM TELAS PEQUENAS ====================
      function desativarChatsPequenaTela() {
        if (window.innerWidth <= 650) {
          contentBoxes.forEach((box) => box.classList.remove("active"));
          menuItems.forEach((item) => item.classList.remove("active"));
          container.classList.remove("hide-sidebar");
          checkActiveChat();
        }
      }

      desativarChatsPequenaTela();
      window.addEventListener("resize", desativarChatsPequenaTela);

      // ==================== TROCA DE CONVERSAS ====================
      menuItems.forEach((item) => {
        item.addEventListener("click", () => {
          menuItems.forEach((i) => i.classList.remove("active"));
          item.classList.add("active");

          contentBoxes.forEach((box) => box.classList.remove("active"));
          const targetId = item.getAttribute("data-target");
          document.getElementById(targetId).classList.add("active");

          if (window.innerWidth <= 800) {
            container.classList.add("hide-sidebar");
          }
          checkActiveChat();
        });
      });

      // ==================== BOT√ÉO SAIR DO CHAT ====================
      sairBotoes.forEach((btn) => {
        btn.addEventListener("click", () => {
          const contentBox = btn.closest(".content-box");
          contentBox.classList.remove("active");

          if (window.innerWidth <= 800) {
            container.classList.remove("hide-sidebar");
          }

          menuItems.forEach((i) => i.classList.remove("active"));
          checkActiveChat();
        });
      });

      // ==================== ENVIO DE MENSAGENS ====================
      chatInputs.forEach((inputBox, index) => {
        const input = inputBox.querySelector("input");
        const button = inputBox.querySelector("button");
        const mensagens = contentBoxes[index].querySelector(".mensagens");

        button.addEventListener("click", () => {
          if (input.value.trim() === "") return;

          const msgArticle = document.createElement("article");
          msgArticle.classList.add("usuario-mensagem");

          const infoSection = document.createElement("section");
          infoSection.classList.add("info");

          const p = document.createElement("p");
          p.textContent = input.value;

          const span = document.createElement("span");
          span.classList.add("hora");
          const now = new Date();
          span.textContent = `${now.getHours()}:${now
            .getMinutes()
            .toString()
            .padStart(2, "0")}`;

          infoSection.appendChild(p);
          infoSection.appendChild(span);
          msgArticle.appendChild(infoSection);
          mensagens.appendChild(msgArticle);
          mensagens.scrollTop = mensagens.scrollHeight;

          input.value = "";
        });
      });
    </script>

    <%- include('../partials/footer.ejs') %>
  </body>
</html>
